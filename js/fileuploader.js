(function($){"use strict";$.fn.fileuploader=function(q){return this.each(function(t,r){var s=$(r),p=null,o=null,l=null,sl=[],n=$.extend(!0,{},$.fn.fileuploader.defaults,q),f={init:function(){return s.closest(".fileuploader").length||s.wrap("<div class=\"fileuploader\"></div>"),p=s.closest(".fileuploader"),f.set("attrOpts"),f.isSupported()?!(n.beforeRender&&$.isFunction(n.beforeRender)&&!1===n.beforeRender(p,s))&&void(f.redesign(),n.files&&f.files.append(n.files),f.rendered=!0,n.afterRender&&$.isFunction(n.afterRender)?n.afterRender(l,p,o,s):null,!f.disabled&&f.bindUnbindEvents(!0)):(n.onSupportError&&$.isFunction(n.onSupportError)?n.onSupportError(p,s):null,!1)},bindUnbindEvents:function(e){e&&f.bindUnbindEvents(!1),s[e?"on":"off"](f._assets.getAllEvents(),f.onEvent),n.changeInput&&o!==s&&o[e?"on":"off"]("click",f.clickHandler),n.dragDrop&&n.dragDrop.container.length&&(n.dragDrop.container[e?"on":"off"]("drag dragstart dragend dragover dragenter dragleave drop",function(t){t.preventDefault()}),n.dragDrop.container[e?"on":"off"]("drop",f.dragDrop.onDrop),n.dragDrop.container[e?"on":"off"]("dragover",f.dragDrop.onDragEnter),n.dragDrop.container[e?"on":"off"]("dragleave",f.dragDrop.onDragLeave)),f.isUploadMode()&&n.clipboardPaste&&$(window)[e?"on":"off"]("paste",f.clipboard.paste),n.sorter&&n.thumbnails&&n.thumbnails._selectors.sorter&&f.sorter[e?"init":"destroy"](),s.closest("form")[e?"on":"off"]("reset",f.reset)},redesign:function(){if(o=s,n.theme&&p.addClass("fileuploader-theme-"+n.theme),n.changeInput){switch((typeof n.changeInput+"").toLowerCase()){case"boolean":o=$("<div class=\"fileuploader-input\"><div class=\"fileuploader-input-caption\"><span>"+f._assets.textParse(n.captions.feedback)+"</span></div><div class=\"fileuploader-input-button\"><span>"+f._assets.textParse(n.captions.button)+"</span></div></div>");break;case"string":" "!=n.changeInput&&(o=$(f._assets.textParse(n.changeInput,n)));break;case"object":o=$(n.changeInput);break;case"function":o=$(n.changeInput(s,p,n,f._assets.textParse));}s.after(o),s.css({position:"absolute","z-index":"-9999",height:"0",width:"0",padding:"0",margin:"0","line-height":"0",outline:"0",border:"0",opacity:"0"})}n.thumbnails&&f.thumbnails.create(),n.dragDrop&&(n.dragDrop="object"==typeof n.dragDrop?n.dragDrop:{container:null},n.dragDrop.container=n.dragDrop.container?$(n.dragDrop.container):o)},clickHandler:function(t){return t.preventDefault(),f.clipboard._timer?void f.clipboard.clean():void s.click()},onEvent:function(t){switch(t.type){case"focus":p?p.addClass("fileuploader-focused"):null;break;case"blur":p?p.removeClass("fileuploader-focused"):null;break;case"change":f.onChange.call(this);}n.listeners&&$.isFunction(n.listeners[t.type])?n.listeners[t.type].call(s,p):null},set:function(e,t){switch(e){case"attrOpts":for(var i,a=["limit","maxSize","fileMaxSize","extensions","changeInput","theme","addMore","listInput","files"],r=0;r<a.length;r++){if(i="data-fileuploader-"+a[r],f._assets.hasAttr(i))switch(a[r]){case"changeInput":case"addMore":case"listInput":n[a[r]]=-1<["true","false"].indexOf(s.attr(i))?"true"==s.attr(i):s.attr(i);break;case"extensions":n[a[r]]=s.attr(i).replace(/ /g,"").split(",");break;case"files":n[a[r]]=JSON.parse(s.attr(i));break;default:n[a[r]]=s.attr(i);}s.removeAttr(i)}(null!=s.attr("disabled")||null!=s.attr("readonly")||0===n.limit)&&(f.disabled=!0),(!n.limit||n.limit&&2<=n.limit)&&(s.attr("multiple","multiple"),n.inputNameBrackets&&"[]"!=s.attr("name").slice(-2)?s.attr("name",s.attr("name")+"[]"):null),!0===n.listInput&&(n.listInput=$("<input type=\"hidden\" name=\"fileuploader-list-"+s.attr("name").replace("[]","").split("[").pop().replace("]","")+"\">").insertBefore(s)),"string"==typeof n.listInput&&0==$(n.listInput).length&&(n.listInput=$("<input type=\"hidden\" name=\""+n.listInput+"\">").insertBefore(s)),f.set("disabled",f.disabled),!n.fileMaxSize&&n.maxSize&&(n.fileMaxSize=n.maxSize);break;case"disabled":f.disabled=t,p[f.disabled?"addClass":"removeClass"]("fileuploader-disabled"),s[f.disabled?"attr":"removeAttr"]("disabled","disabled"),f.rendered&&f.bindUnbindEvents(!t);break;case"feedback":t||(t=f._assets.textParse(0<f._itFl.length?n.captions.feedback2:n.captions.feedback,{length:f._itFl.length})),$(!o.is(":file"))?o.find(".fileuploader-input-caption span").html(t):null;break;case"input":var d=f._assets.copyAllAttributes($("<input type=\"file\">"),s,!0);f.bindUnbindEvents(!1),s.after(s=d).remove(),f.bindUnbindEvents(!0);break;case"prevInput":0<sl.length&&(f.bindUnbindEvents(!1),sl[t].remove(),sl.splice(t,1),s=sl[sl.length-1],f.bindUnbindEvents(!0));break;case"nextInput":var d=f._assets.copyAllAttributes($("<input type=\"file\">"),s);f.bindUnbindEvents(!1),0<sl.length&&0==sl[sl.length-1].get(0).files.length?s=sl[sl.length-1]:(-1==sl.indexOf(s)?sl.push(s):null,sl.push(d),s.after(s=d)),f.bindUnbindEvents(!0);break;case"listInput":n.listInput&&n.listInput.val(f.files.list(!0,null,!1,t));}},onChange:function(a,e){var r=s.get(0).files;if(e)if(e.length)r=e;else return f.set("input",""),f.files.clear(),!1;if(f.clipboard._timer&&f.clipboard.clean(),!(f.isDefaultMode()&&(f.reset(),0==r.length))){if(n.beforeSelect&&$.isFunction(n.beforeSelect)&&!1==n.beforeSelect(r,l,p,o,s))return!1;for(var d=0,u=0;u<r.length;u++){var c=r[u],h=f._itFl[f.files.add(c,"choosed")],m=f.files.check(h,r,0==u);if(!0!==m){if(f.files.remove(h,!0),m[2]||(f.isDefaultMode()&&(f.set("input",""),f.reset(),m[3]=!0),m[1]?n.dialogs.alert(m[1],h,l,p,o,s):null),m[3])break;continue}n.thumbnails&&f.thumbnails.item(h),f.isUploadMode()&&f.upload.prepare(h),n.onSelect&&$.isFunction(n.onSelect)?n.onSelect(h,l,p,o,s):null,d++}f.isUploadMode()&&0<d&&f.set("input",""),f.set("feedback",null),f.isAddMoreMode()&&0<d&&f.set("nextInput"),f.set("listInput",null),n.afterSelect&&$.isFunction(n.afterSelect)?n.afterSelect(l,p,o,s):null}},thumbnails:{create:function(){null!=n.thumbnails.beforeShow&&$.isFunction(n.thumbnails.beforeShow)?n.thumbnails.beforeShow(p,o,s):null;var e=$(f._assets.textParse(n.thumbnails.box)).appendTo(n.thumbnails.boxAppendTo?n.thumbnails.boxAppendTo:p);l=e.is(n.thumbnails._selectors.list)?e:e.find(n.thumbnails._selectors.list),n.thumbnails._selectors.popup_open&&l.on("click",n.thumbnails._selectors.popup_open,function(t){t.preventDefault();var e=$(this).closest(n.thumbnails._selectors.item),o=f.files.find(e);o&&o.popup&&o.html.hasClass("file-has-popup")&&f.thumbnails.popup(o)}),f.isUploadMode()&&n.thumbnails._selectors.start&&l.on("click",n.thumbnails._selectors.start,function(t){if(t.preventDefault(),f.locked)return!1;var e=$(this).closest(n.thumbnails._selectors.item),o=f.files.find(e);o&&f.upload.send(o,!0)}),f.isUploadMode()&&n.thumbnails._selectors.retry&&l.on("click",n.thumbnails._selectors.retry,function(t){if(t.preventDefault(),f.locked)return!1;var e=$(this).closest(n.thumbnails._selectors.item),o=f.files.find(e);o&&f.upload.retry(o)}),n.thumbnails._selectors.rotate&&l.on("click",n.thumbnails._selectors.rotate,function(t){if(t.preventDefault(),f.locked)return!1;var e=$(this).closest(n.thumbnails._selectors.item),o=f.files.find(e);o&&o.editor&&(o.editor.rotate(),o.editor.save())}),n.thumbnails._selectors.remove&&l.on("click",n.thumbnails._selectors.remove,function(t){if(t.preventDefault(),f.locked)return!1;var e=$(this).closest(n.thumbnails._selectors.item),o=f.files.find(e),i=function(){f.files.remove(o)};o&&(o.upload&&"successful"!=o.upload.status?f.upload.cancel(o):n.thumbnails.removeConfirmation?n.dialogs.confirm(f._assets.textParse(n.captions.removeConfirmation,o),i):i())})},clear:function(){l&&l.html("")},item:function(e,t){e.icon=f.thumbnails.generateFileIcon(e.format,e.extension),e.image="<div class=\"fileuploader-item-image\"></div>",e.progressBar=f.isUploadMode()?"<div class=\"fileuploader-progressbar\"><div class=\"bar\"></div></div>":"",e.html=$(f._assets.textParse(e.appended&&n.thumbnails.item2?n.thumbnails.item2:n.thumbnails.item,e)),e.progressBar=e.html.find(".fileuploader-progressbar"),e.html.addClass("file-type-"+(e.format?e.format:"no")+" file-ext-"+(e.extension?e.extension:"no")+""),t?t.replaceWith(e.html):e.html[n.thumbnails.itemPrepend?"prependTo":"appendTo"](l),n.thumbnails.popup&&(e.popup={open:function(){f.thumbnails.popup(e)}}),f.thumbnails.renderThumbnail(e),e.renderThumbnail=function(t){t&&e.popup&&e.popup.close&&(e.popup.close(),e.popup={open:e.popup.open}),f.thumbnails.renderThumbnail(e,!0,t)},null!=n.thumbnails.onItemShow&&$.isFunction(n.thumbnails.onItemShow)?n.thumbnails.onItemShow(e,l,p,o,s):null},generateFileIcon:function(e,t){var o="<div style=\"${style}\" class=\"fileuploader-item-icon${class}\"><i>"+(t?t:"")+"</i></div>",i=f._assets.textToColor(t);if(i){var a=f._assets.isBrightColor(i);a&&(o=o.replace("${class}"," is-bright-color")),o=o.replace("${style}","background-color: "+i)}return o.replace("${style}","").replace("${class}","")},renderThumbnail:function(t,i,a){var r=t.html.find(".fileuploader-item-image"),e=t.data&&t.data.readerSkip,d=function(e){var i=$(e);r.removeClass("fileuploader-no-thumbnail fileuploader-loading").html(i),t.popup&&t.html.addClass("file-has-popup"),i.is("img")&&i.attr("draggable","false").on("load error",function(i){"error"==i.type&&u(!0),c(),null!=n.thumbnails.onImageLoaded&&$.isFunction(n.thumbnails.onImageLoaded)?n.thumbnails.onImageLoaded(t,l,p,o,s):null}),i.is("canvas")&&(null!=n.thumbnails.onImageLoaded&&$.isFunction(n.thumbnails.onImageLoaded)?n.thumbnails.onImageLoaded(t,l,p,o,s):null)},u=function(e){r.addClass("fileuploader-no-thumbnail"),r.removeClass("fileuploader-loading").html(t.icon),t.popup&&t.html.addClass("file-has-popup"),e&&(null!=n.thumbnails.onImageLoaded&&$.isFunction(n.thumbnails.onImageLoaded)?n.thumbnails.onImageLoaded(t,l,p,o,s):null)},c=function(){var e=0;if(t&&-1<f._pfrL.indexOf(t))for(f._pfrL.splice(f._pfrL.indexOf(t),1);e<f._pfrL.length;){if(-1<f._itFl.indexOf(f._pfrL[e])){setTimeout(function(){f.thumbnails.renderThumbnail(f._pfrL[e],!0)},"image"==t.format&&1.8<t.size/1e6?200:0);break}else f._pfrL.splice(e,1);e++}};if(!r.length)return void c();if(t.image=r.html("").addClass("fileuploader-loading"),(-1<["image","video","audio","astext"].indexOf(t.format)||t.data.thumbnail)&&f.isFileReaderSupported()&&!e&&(t.appended||n.thumbnails.startImageRenderer||i)){if(t.html.removeClass("file-has-popup"),n.thumbnails.synchronImages&&(-1!=f._pfrL.indexOf(t)||i?null:f._pfrL.push(t),1<f._pfrL.length&&!i))return;var h=function(e,o){var i=e.nodeName&&"img"==e.nodeName.toLocaleLowerCase(),a=i?e.src:e;if(n.thumbnails.canvasImage){var p=document.createElement("canvas"),s=i?e:new Image,l=function(){f.editor.resize(this,p,n.thumbnails.canvasImage.width?n.thumbnails.canvasImage.width:r.width(),n.thumbnails.canvasImage.height?n.thumbnails.canvasImage.height:r.height(),!1,!0),f._assets.isBlankCanvas(p)?u():d(p),c()},h=function(){u(!0),c(),s=null};if("image"==t.format&&o&&t.reader.node)return l.call(t.reader.node);if(!a)return h();if(i)return l.call(e);s.onload=l,s.onerror=h,t.data&&t.data.readerCrossOrigin&&s.setAttribute("crossOrigin",t.data.readerCrossOrigin),s.src=a}else d(i?e:"<img src=\""+a+"\">")};return"string"==typeof a||"object"==typeof a?h(a):f.files.read(t,function(){t.reader.node&&(t.reader.frame||"img"==t.reader.node.nodeName.toLowerCase())?h(t.reader.frame||t.reader.src,!0):(u("image"==t.format),c())},null,a,!0)}u()},popup:function(t,r){if(!f.locked&&n.thumbnails.popup&&n.thumbnails._selectors.popup){var d=$(n.thumbnails.popup.container),u=d.find(".fileuploader-popup"),c=function(){var e=t.popup.html||$(f._assets.textParse(n.thumbnails.popup.template,t)),i=t.popup.html!==e,a=function(o){var e=o.which||o.keyCode;27==e&&t.popup&&t.popup.close&&t.popup.close(),(37==e||39==e)&&n.thumbnails.popup.arrows&&t.popup.move(37==e?"prev":"next")};u.removeClass("loading"),u.children(n.thumbnails._selectors.popup).length&&($.each(f._itFl,function(e,o){o!=t&&o.popup&&o.popup.close&&o.popup.close(r)}),u.find(n.thumbnails._selectors.popup).remove()),e.show().appendTo(u),t.popup.html=e,t.popup.move=function(e){var o=f._itFl.indexOf(t),r=null,d=!1;if(e=n.thumbnails.itemPrepend?"prev"==e?"next":"prev":e,"prev"==e)for(var p,s=o;0<=s;s--){if(p=f._itFl[s],p!=t&&p.popup&&p.html.hasClass("file-has-popup")){r=p;break}0!=s||r||d||!n.thumbnails.popup.loop||(s=f._itFl.length,d=!0)}else for(var p,s=o;s<f._itFl.length;s++){if(p=f._itFl[s],p!=t&&p.popup&&p.html.hasClass("file-has-popup")){r=p;break}s+1!=f._itFl.length||r||d||!n.thumbnails.popup.loop||(s=-1,d=!0)}r&&f.thumbnails.popup(r,!0)},t.popup.close=function(e){t.reader.node&&(t.reader.node.pause?t.reader.node.pause():null),$(window).off("keyup",a),d.css({overflow:"",width:""}),t.popup.editor&&t.popup.editor.cropper&&t.popup.editor.cropper.hide(),t.popup.zoomer&&t.popup.zoomer.hide(),t.popup.html&&n.thumbnails.popup.onHide&&$.isFunction(n.thumbnails.popup.onHide)?n.thumbnails.popup.onHide(t,l,p,o,s):t.popup.html?t.popup.html.remove():null,e||u.fadeOut(400,function(){u.remove()}),delete t.popup.close},t.reader.node?(i&&e.html(e.html().replace(/\$\{reader\.node\}/,"<div class=\"reader-node\"></div>")).find(".reader-node").html(t.reader.node),t.reader.node.controls=!0,t.reader.node.currentTime=0,t.reader.node.play?t.reader.node.play():null):i&&e.find(".fileuploader-popup-node").html("<div class=\"reader-node\"><div class=\"fileuploader-popup-file-icon\">"+t.icon+"</div></div>"),$(window).on("keyup",a),d.css({overflow:"hidden",width:d.innerWidth()}),t.popup.html.find("[data-action=\"prev\"], [data-action=\"next\"]").removeAttr("style"),t.popup.html[1!=f._itFl.length&&n.thumbnails.popup.arrows?"addClass":"removeClass"]("fileuploader-popup-has-arrows"),n.thumbnails.popup.loop||(0==f._itFl.indexOf(t)&&t.popup.html.find("[data-action=\"prev\"]").hide(),f._itFl.indexOf(t)==f._itFl.length-1&&t.popup.html.find("[data-action=\"next\"]").hide()),f.editor.zoom(t),t.editor&&(!t.popup.editor&&(t.popup.editor={}),f.editor.rotate(t,t.popup.editor.rotation||t.editor.rotation||0,!0),t.popup.editor&&t.popup.editor.cropper&&(t.popup.editor.cropper.hide(!0),setTimeout(function(){f.editor.crop(t,t.editor.crop?$.extend({},t.editor.crop):t.popup.editor.cropper.setDefaultData())},100))),t.popup.html.on("click","[data-action=\"prev\"]",function(){t.popup.move("prev")}).on("click","[data-action=\"next\"]",function(){t.popup.move("next")}).on("click","[data-action=\"crop\"]",function(){t.editor&&t.editor.cropper()}).on("click","[data-action=\"rotate-cw\"]",function(){t.editor&&t.editor.rotate()}).on("click","[data-action=\"zoom-in\"]",function(){t.popup.zoomer&&t.popup.zoomer.zoomIn()}).on("click","[data-action=\"zoom-out\"]",function(){t.popup.zoomer&&t.popup.zoomer.zoomOut()}),n.thumbnails.popup.onShow&&$.isFunction(n.thumbnails.popup.onShow)?n.thumbnails.popup.onShow(t,l,p,o,s):null};0==u.length&&(u=$("<div class=\"fileuploader-popup\"></div>").appendTo(d)),u.fadeIn(400).addClass("loading"),-1<["image/","video/","audio/","application/pdf","astext"].indexOf(t.type)&&!t.popup.html?f.files.read(t,c):c()}}},editor:{rotate:function(e,t,o){var i=e.popup&&e.popup.html&&$("html").find(e.popup.html).length;if(!i){var a=e.editor.rotation||0,r=t?t:a+90;return 360<=r&&(r=0),e.popup.editor&&(e.popup.editor.rotation=r),e.editor.rotation=r}if(e.reader.node){if(e.popup.editor.isAnimating)return;e.popup.editor.isAnimating=!0;var d=e.popup.html,n=d.find(".fileuploader-popup-node"),p=n.find(".reader-node"),s=p.find("> img"),a=e.popup.editor.rotation||0,l=e.popup.editor.scale||1,u={rotation:a,scale:l};e.popup.editor.cropper&&e.popup.editor.cropper.$template.hide(),e.popup.editor.rotation=o?t:a+90,e.popup.editor.scale=(p.height()/s[-1<[90,270].indexOf(e.popup.editor.rotation)?"width":"height"]()).toFixed(3),s.height()*e.popup.editor.scale>p.width()&&-1<[90,270].indexOf(e.popup.editor.rotation)&&(e.popup.editor.scale=p.height()/s.width()),1<e.popup.editor.scale&&(e.popup.editor.scale=1),$(u).stop().animate({rotation:e.popup.editor.rotation,scale:e.popup.editor.scale},{duration:o?2:300,easing:"swing",step:function(e,t){var o=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("transform")||"none",i=0,r=1,d=t.prop;if("none"!==o){var n=o.split("(")[1].split(")")[0].split(","),p=n[0],a=n[1];i="rotation"==d?e:Math.round(Math.atan2(a,p)*(180/Math.PI)),r="scale"==d?e:Math.round(10*Math.sqrt(p*p+a*a))/10}s.css({"-webkit-transform":"rotate("+i+"deg) scale("+r+")","-moz-transform":"rotate("+i+"deg) scale("+r+")",transform:"rotate("+i+"deg) scale("+r+")"})},always:function(){delete e.popup.editor.isAnimating,e.popup.editor.cropper&&!o&&(e.popup.editor.cropper.setDefaultData(),e.popup.editor.cropper.init("rotation"))}}),360<=e.popup.editor.rotation&&(e.popup.editor.rotation=0),e.popup.editor.rotation!=e.editor.rotation&&(e.popup.editor.hasChanges=!0)}},crop:function(t,o){var i=t.popup&&t.popup.html&&$("html").find(t.popup.html).length;if(!i)return t.editor.crop=o||t.editor.crop;if(t.reader.node)if(!t.popup.editor.cropper){var a=t.popup.html,r=a.find(".fileuploader-popup-node .reader-node > img"),d=$("<div class=\"fileuploader-cropper\"><div class=\"fileuploader-cropper-area\"><div class=\"point point-a\"></div><div class=\"point point-b\"></div><div class=\"point point-c\"></div><div class=\"point point-d\"></div><div class=\"point point-e\"></div><div class=\"point point-f\"></div><div class=\"point point-g\"></div><div class=\"point point-h\"></div><div class=\"area-move\"></div><div class=\"area-image\"></div><div class=\"area-info\"></div></div></div>"),p=d.find(".fileuploader-cropper-area");t.popup.editor.cropper={$imageEl:r,$template:d,$editor:p,isCropping:!1,crop:o||null,init:function(e){var o=t.popup.editor.cropper,i=o.$imageEl.position(),a=o.$imageEl[0].getBoundingClientRect().width,r=o.$imageEl[0].getBoundingClientRect().height,p=t.popup.editor.rotation&&-1<[90,270].indexOf(t.popup.editor.rotation),s=p?t.popup.editor.scale:1;return o.hide(),o.crop||o.setDefaultData(),0==a||0==r?o.hide(!0):void(!o.isCropping&&(o.$imageEl.clone().appendTo(o.$template.find(".area-image")),o.$imageEl.parent().append(d)),o.$template.hide().css({left:i.left,top:i.top,width:a,height:r}).fadeIn(150),o.$editor.hide(),clearTimeout(o._editorAnimationTimeout),o._editorAnimationTimeout=setTimeout(function(){if(delete o._editorAnimationTimeout,o.$editor.fadeIn(250),t.editor.crop&&$.isPlainObject(e)&&(o.resize(),o.crop.left=o.crop.left*o.crop.cfWidth*s,o.crop.width=o.crop.width*o.crop.cfWidth*s,o.crop.top=o.crop.top*o.crop.cfHeight*s,o.crop.height=o.crop.height*o.crop.cfHeight*s),n.editor.cropper&&(n.editor.cropper.maxWidth||n.editor.cropper.maxHeight)&&(n.editor.cropper.maxWidth&&(o.crop.width=Math.min(n.editor.cropper.maxWidth*o.crop.cfWidth,o.crop.width)),n.editor.cropper.maxHeight&&(o.crop.height=Math.min(n.editor.cropper.maxHeight*o.crop.cfHeight,o.crop.height)),(!t.editor.crop||"rotation"==e)&&"resize"!=e&&(o.crop.left=(o.$template.width()-o.crop.width)/2,o.crop.top=(o.$template.height()-o.crop.height)/2)),(!t.editor.crop||"rotation"==e)&&n.editor.cropper&&n.editor.cropper.ratio&&"resize"!=e){var i=n.editor.cropper.ratio,a=f._assets.ratioToPx(o.crop.width,o.crop.height,i);a&&(o.crop.width=Math.min(o.crop.width,a[0]),o.crop.left=(o.$template.width()-o.crop.width)/2,o.crop.height=Math.min(o.crop.height,a[1]),o.crop.top=(o.$template.height()-o.crop.height)/2)}o.drawPlaceHolder(o.crop)},400),n.editor.cropper&&n.editor.cropper.showGrid&&o.$editor.addClass("has-grid"),o.$imageEl.attr("draggable","false"),o.$template.on("mousedown touchstart",o.mousedown),$(window).on("resize",o.resize),o.isCropping=!0,t.popup.editor.hasChanges=!0)},setDefaultData:function(){var e=t.popup.editor.cropper,o=e.$imageEl,i=o.width(),a=o.height(),r=t.popup.editor.rotation&&-1<[90,270].indexOf(t.popup.editor.rotation),d=t.popup.editor.scale||1;return e.crop={left:0,top:0,width:r?a*d:i,height:r?i*d:a,cfWidth:i/t.reader.width,cfHeight:a/t.reader.height},null},hide:function(e){var o=t.popup.editor.cropper;e&&(o.$template.hide(),o.$editor.hide()),o.$imageEl.attr("draggable",""),o.$template.off("mousedown touchstart",o.mousedown),$(window).off("resize",o.resize)},resize:function(o){var e=t.popup.editor.cropper,i=e.$imageEl;0<i.width()&&(o?(e.$template.hide(),clearTimeout(e._resizeTimeout),e._resizeTimeout=setTimeout(function(){delete e._resizeTimeout;var o=i.width()/t.reader.width,a=i.height()/t.reader.height;e.crop.left=e.crop.left/e.crop.cfWidth*o,e.crop.width=e.crop.width/e.crop.cfWidth*o,e.crop.top=e.crop.top/e.crop.cfHeight*a,e.crop.height=e.crop.height/e.crop.cfHeight*a,e.crop.cfWidth=o,e.crop.cfHeight=a,e.init("resize")},500)):(e.crop.cfWidth=i.width()/t.reader.width,e.crop.cfHeight=i.height()/t.reader.height))},drawPlaceHolder:function(e){var o=t.popup.editor.cropper,i=t.popup.editor.rotation||0,a=t.popup.editor.scale||1,r=[0,0];e&&(e=$.extend({},e),i&&(r=[180==i||270==i?-100:0,90==i||180==i?-100:0]),o.$editor.css(e),o.setAreaInfo(),o.$editor.find(".area-image img").removeAttr("style").css({width:o.$imageEl.width(),height:o.$imageEl.height(),left:-1*o.$editor.position().left,top:-1*o.$editor.position().top,"-webkit-transform":"rotate("+i+"deg) scale("+a+") translateX("+r[0]+"%) translateY("+r[1]+"%)","-moz-transform":"rotate("+i+"deg) scale("+a+") translateX("+r[0]+"%) translateY("+r[1]+"%)",transform:"rotate("+i+"deg) scale("+a+") translateX("+r[0]+"%) translateY("+r[1]+"%)"}))},setAreaInfo:function(e){var o=t.popup.editor.cropper,i=t.popup.editor.scale||1;o.$editor.find(".area-info").html((o.isResizing||"size"==e?["W: "+Math.round(o.crop.width/o.crop.cfWidth/i)+"px"," ","H: "+Math.round(o.crop.height/o.crop.cfHeight/i)+"px"]:["X: "+Math.round(o.crop.left/o.crop.cfWidth/i)+"px"," ","Y: "+Math.round(o.crop.top/o.crop.cfHeight/i)+"px"]).join(""))},mousedown:function(o){var e=o.originalEvent.touches&&o.originalEvent.touches[0]?"touchstart":"mousedown",i=$(o.target),a=t.popup.editor.cropper,r={x:("mousedown"==e?o.pageX:o.originalEvent.touches[0].pageX)-a.$template.offset().left,y:("mousedown"==e?o.pageY:o.originalEvent.touches[0].pageY)-a.$template.offset().top},d=function(){a.pointData={el:i,x:r.x,y:r.y,xEditor:r.x-a.crop.left,yEditor:r.y-a.crop.top,left:a.crop.left,top:a.crop.top,width:a.crop.width,height:a.crop.height},(a.isMoving||a.isResizing)&&(a.setAreaInfo("size"),a.$editor.addClass("moving show-info"),$("body").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),$(document).on("mousemove touchmove",a.mousemove))};t.popup.zoomer&&t.popup.zoomer.hasSpacePressed||(a.isMoving=i.is(".area-move"),a.isResizing=i.is(".point"),"mousedown"==e&&d(),"touchstart"==e&&1==o.originalEvent.touches.length&&((a.isMoving||a.isResizing)&&o.preventDefault(),a.isTouchLongPress=!0,setTimeout(function(){a.isTouchLongPress&&(delete a.isTouchLongPress,d())},n.thumbnails.touchDelay?n.thumbnails.touchDelay:0)),$(document).on("mouseup touchend",a.mouseup))},mousemove:function(o){var e=o.originalEvent.touches&&o.originalEvent.touches[0]?"touchstart":"mousedown",i=$(o.target),a=t.popup.editor.cropper,r={x:("mousedown"==e?o.pageX:o.originalEvent.touches[0].pageX)-a.$template.offset().left,y:("mousedown"==e?o.pageY:o.originalEvent.touches[0].pageY)-a.$template.offset().top};if(o.originalEvent.touches&&1!=o.originalEvent.touches.length)return a.mouseup(o);if(a.isMoving){var d=r.x-a.pointData.xEditor,p=r.y-a.pointData.yEditor;d+a.crop.width>a.$template.width()&&(d=a.$template.width()-a.crop.width),0>d&&(d=0),p+a.crop.height>a.$template.height()&&(p=a.$template.height()-a.crop.height),0>p&&(p=0),a.crop.left=d,a.crop.top=p}if(a.isResizing){var s,l=a.pointData.el.attr("class").substr(12),u=a.crop.left+a.crop.width,c=a.crop.top+a.crop.height,h=(n.editor.cropper&&n.editor.cropper.minWidth||0)*a.crop.cfWidth,m=(n.editor.cropper&&n.editor.cropper.minHeight||0)*a.crop.cfHeight,g=(n.editor.cropper&&n.editor.cropper.maxWidth)*a.crop.cfWidth,v=(n.editor.cropper&&n.editor.cropper.maxHeight)*a.crop.cfHeight,b=n.editor.cropper?n.editor.cropper.ratio:null;if(h>a.$template.width()&&(h=a.$template.width()),m>a.$template.height()&&(m=a.$template.height()),g>a.$template.width()&&(g=a.$template.width()),v>a.$template.height()&&(v=a.$template.height()),("a"==l||"b"==l||"c"==l)&&!s&&(a.crop.top=r.y,0>a.crop.top&&(a.crop.top=0),a.crop.height=c-a.crop.top,a.crop.top>a.crop.top+a.crop.height&&(a.crop.top=c,a.crop.height=0),a.crop.height<m&&(a.crop.top=c-m,a.crop.height=m),a.crop.height>v&&(a.crop.top=c-v,a.crop.height=v),s=b?f._assets.ratioToPx(a.crop.width,a.crop.height,b):null,s&&(a.crop.width=s[0],("a"==l||"b"==l)&&(a.crop.left=Math.max(0,a.pointData.left+(a.pointData.width-a.crop.width)/("b"==l?2:1))),a.crop.left+a.crop.width>a.$template.width()))){var w=a.$template.width()-a.crop.left;a.crop.width=w,a.crop.height=w/s[2]*s[3],a.crop.top=c-a.crop.height}if(("e"==l||"f"==l||"g"==l)&&!s&&(a.crop.height=r.y-a.crop.top,a.crop.height+a.crop.top>a.$template.height()&&(a.crop.height=a.$template.height()-a.crop.top),a.crop.height<m&&(a.crop.height=m),a.crop.height>v&&(a.crop.height=v),s=b?f._assets.ratioToPx(a.crop.width,a.crop.height,b):null,s&&(a.crop.width=s[0],("f"==l||"g"==l)&&(a.crop.left=Math.max(0,a.pointData.left+(a.pointData.width-a.crop.width)/("f"==l?2:1))),a.crop.left+a.crop.width>a.$template.width()))){var w=a.$template.width()-a.crop.left;a.crop.width=w,a.crop.height=w/s[2]*s[3]}if(("c"==l||"d"==l||"e"==l)&&!s&&(a.crop.width=r.x-a.crop.left,a.crop.width+a.crop.left>a.$template.width()&&(a.crop.width=a.$template.width()-a.crop.left),a.crop.width<h&&(a.crop.width=h),a.crop.width>g&&(a.crop.width=g),s=b?f._assets.ratioToPx(a.crop.width,a.crop.height,b):null,s&&(a.crop.height=s[1],("c"==l||"d"==l)&&(a.crop.top=Math.max(0,a.pointData.top+(a.pointData.height-a.crop.height)/("d"==l?2:1))),a.crop.top+a.crop.height>a.$template.height()))){var x=a.$template.height()-a.crop.top;a.crop.height=x,a.crop.width=x/s[3]*s[2]}if(("a"==l||"g"==l||"h"==l)&&!s&&(a.crop.left=r.x,a.crop.left>a.$template.width()&&(a.crop.left=a.$template.width()),0>a.crop.left&&(a.crop.left=0),a.crop.width=u-a.crop.left,a.crop.left>a.crop.left+a.crop.width&&(a.crop.left=u,a.crop.width=0),a.crop.width<h&&(a.crop.left=u-h,a.crop.width=h),a.crop.width>g&&(a.crop.left=u-g,a.crop.width=g),s=b?f._assets.ratioToPx(a.crop.width,a.crop.height,b):null,s&&(a.crop.height=s[1],("a"==l||"h"==l)&&(a.crop.top=Math.max(0,a.pointData.top+(a.pointData.height-a.crop.height)/("h"==l?2:1))),a.crop.top+a.crop.height>a.$template.height()))){var x=a.$template.height()-a.crop.top;a.crop.height=x,a.crop.width=x/s[3]*s[2],a.crop.left=u-a.crop.width}}a.drawPlaceHolder(a.crop)},mouseup:function(){var e=t.popup.editor.cropper;(0==e.$editor.width()||0==e.$editor.height())&&e.init(e.setDefaultData()),delete e.isTouchLongPress,delete e.isMoving,delete e.isResizing,e.$editor.removeClass("moving show-info"),$("body").css({"-webkit-user-select":"","-moz-user-select":"","-ms-user-select":"","user-select":""}),$(document).off("mousemove touchmove",e.mousemove),$(document).off("mouseup touchend",e.mouseup)}},t.popup.editor.cropper.init()}else o&&(t.popup.editor.cropper.crop=o),t.popup.editor.cropper.init(o)},resize:function(e,t,o,i,a,r){var d=t.getContext("2d"),o=!o&&i?i*e.width/e.height:o,i=!i&&o?o*e.height/e.width:i,n=e.width/e.height,p=1<=n?o:i*n,s=1>n?i:o/n;r&&p<o&&(s*=o/p,p=o),r&&s<i&&(p*=i/s,s=i);var l=Math.min(Math.ceil(Math.log(e.width/p)/Math.log(2)),12);if(t.width=p,t.height=s,e.width<t.width||e.height<t.height||2>l){r||(t.width=Math.min(e.width,t.width),t.height=Math.min(e.height,t.height));var u=e.width<t.width?(t.width-e.width)/2:0,c=e.height<t.height?(t.height-e.height)/2:0;a||(d.fillStyle="#fff",d.fillRect(0,0,t.width,t.height)),d.drawImage(e,u,c,Math.min(e.width,t.width),Math.min(e.height,t.height))}else{var h=document.createElement("canvas"),f=h.getContext("2d"),m=2;for(h.width=e.width/m,h.height=e.height/m,f.fillStyle="#fff",f.fillRect(0,0,h.width,h.height),f.drawImage(e,0,0,h.width,h.height);2<l;){var g=m+2,v=e.width/m,b=e.height/m;v>h.width&&(v=h.width),b>h.height&&(b=h.height),f.drawImage(h,0,0,v,b,0,0,e.width/g,e.height/g),m=g,l--}var v=e.width/m,b=e.height/m;v>h.width&&(v=h.width),b>h.height&&(b=h.height),d.drawImage(h,0,0,v,b,0,0,p,s),h=f=null}d=null},zoom:function(t){var o=t.popup&&t.popup.html&&$("html").find(t.popup.html).length;if(o){if(!t.popup.zoomer){var i=t.popup.html,a=i.find(".fileuploader-popup-node"),r=a.find(".reader-node"),d=r.find("> img").attr("draggable","false").attr("ondragstart","return false;");t.popup.zoomer={html:i.find(".fileuploader-popup-zoomer"),isActive:"image"==t.format&&t.reader.node&&n.thumbnails.popup.zoomer,scale:100,zoom:100,init:function(){var e=this;return!e.isActive||f._assets.isIE()||f._assets.isMobile()?e.html.hide()&&r.addClass("has-node-centered"):void(e.hide(),e.resize(),$(window).on("resize",e.resize),$(window).on("keyup keydown",e.keyPress),e.html.find("input").on("input change",e.range),r.on("mousedown touchstart",e.mousedown),a.on("mousewheel DOMMouseScroll",e.scroll))},hide:function(){var e=this;$(window).off("resize",e.resize),$(window).off("keyup keydown",e.keyPress),e.html.find("input").off("input change",e.range),r.off("mousedown",e.mousedown),a.off("mousewheel DOMMouseScroll",e.scroll)},center:function(e){var t=this,o=0,i=0;e?(o=t.left,i=t.top,o-=(a.width()/2-t.left)*(r.width()/e[0]-1),i-=(a.height()/2-t.top)*(r.height()/e[1]-1),r.width()<=a.width()&&(o=Math.round((a.width()-r.width())/2)),r.height()<=a.height()&&(i=Math.round((a.height()-r.height())/2)),r.width()>a.width()&&(0<o?o=0:o+r.width()<a.width()&&(o=a.width()-r.width())),r.height()>a.height()&&(0<i?i=0:i+r.height()<a.height()&&(i=a.height()-r.height())),i=Math.min(i,0)):(o=Math.round((a.width()-r.width())/2),i=Math.round((a.height()-r.height())/2)),r.css({left:(t.left=o)+"px",top:(t.top=i)+"px"})},resize:function(){var e=t.popup.zoomer;r.removeAttr("style"),e.scale=e.getImageScale(),e.updateView()},range:function(o){var e=t.popup.zoomer,i=$(this),a=parseFloat(i.val());return 100<=e.scale?(o.preventDefault(),void i.val(e.scale)):void(a<e.scale&&(o.preventDefault(),a=e.scale,i.val(a)),e.updateView(a,!0))},scroll:function(o){var e=t.popup.zoomer,i=-100;o.originalEvent&&(o.originalEvent.wheelDelta&&(i=o.originalEvent.wheelDelta/-40),o.originalEvent.deltaY&&(i=o.originalEvent.deltaY),o.originalEvent.detail&&(i=o.originalEvent.detail)),e[0>i?"zoomIn":"zoomOut"](3)},keyPress:function(o){var e=t.popup.zoomer,i=o.type,a=o.keyCode||o.which;32!=a||(e.hasSpacePressed="keydown"==i,e.hasSpacePressed&&e.isZoomed()?r.addClass("is-amoving"):r.removeClass("is-amoving"))},mousedown:function(o){var e=t.popup.zoomer,i=$(o.target),a=o.originalEvent.touches&&o.originalEvent.touches[0]?"touchstart":"mousedown",p={x:"mousedown"==a?o.pageX:o.originalEvent.touches[0].pageX,y:"mousedown"==a?o.pageY:o.originalEvent.touches[0].pageY},s=function(){e.pointData={x:p.x,y:p.y,xTarget:p.x-e.left,yTarget:p.y-e.top},$("body").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),r.addClass("is-moving"),$(document).on("mousemove",e.mousemove)};1==o.which&&100!=e.scale&&e.zoom!=e.scale&&(e.hasSpacePressed||i[0]==d[0]||i.is(".fileuploader-cropper"))&&("mousedown"==a&&s(),"touchstart"==a&&(e.isTouchLongPress=!0,setTimeout(function(){e.isTouchLongPress&&(delete e.isTouchLongPress,s())},n.thumbnails.touchDelay?n.thumbnails.touchDelay:0)),$(document).on("mouseup touchend",e.mouseup))},mousemove:function(o){var e=t.popup.zoomer,i=o.originalEvent.touches&&o.originalEvent.touches[0]?"touchstart":"mousedown",d={x:"mousedown"==i?o.pageX:o.originalEvent.touches[0].pageX,y:"mousedown"==i?o.pageY:o.originalEvent.touches[0].pageY},n=d.x-e.pointData.xTarget,p=d.y-e.pointData.yTarget;0<p&&(p=0),p<a.height()-r.height()&&(p=a.height()-r.height()),r.height()<a.height()&&(p=a.height()/2-r.height()/2),r.width()>a.width()?(0<n&&(n=0),n<a.width()-r.width()&&(n=a.width()-r.width())):n=a.width()/2-r.width()/2,r.css({left:(e.left=n)+"px",top:(e.top=p)+"px"})},mouseup:function(){var e=t.popup.zoomer;delete e.pointData,$("body").css({"-webkit-user-select":"","-moz-user-select":"","-ms-user-select":"","user-select":""}),r.removeClass("is-moving"),$(document).off("mousemove",e.mousemove),$(document).off("mouseup",e.mouseup)},zoomIn:function(e){var o=t.popup.zoomer;100<=o.zoom||(o.zoom=Math.min(100,o.zoom+(e||20)),o.updateView(o.zoom))},zoomOut:function(e){var o=t.popup.zoomer;o.zoom<=o.scale||(o.zoom=Math.max(o.scale,o.zoom-(e||20)),o.updateView(o.zoom))},updateView:function(e,o){var i=this,a=i.getImageSize().width/100*e,d=i.getImageSize().height/100*e,n=r.width(),p=r.height(),s=e&&e!=i.scale;return i.isActive?void(s?r.addClass("is-movable").css({width:a+"px",height:d+"px",maxWidth:"none",maxHeight:"none"}):r.removeClass("is-movable is-amoving").removeAttr("style"),i.zoom=e||i.scale,i.center(s?[n,p,i.left,i.top]:null),i.html.find("span").html(i.zoom+"%"),!o&&i.html.find("input").val(i.zoom),e&&t.popup.editor&&t.popup.editor.cropper&&t.popup.editor.cropper.resize(!0)):i.center()},isZoomed:function(){var e=this;return e.zoom>e.scale},getImageSize:function(){this;return{width:d.prop("naturalWidth"),height:d.prop("naturalHeight")}},getImageScale:function(){this;return Math.round(100/(d.prop("naturalWidth")/d.width()))}}}t.popup.zoomer.init()}},save:function(e,t,i,a,r){var d=e.popup&&e.popup.html&&$("html").find(e.popup.html).length,u=new Image,c=function(){if(e.reader.node){var d=document.createElement("canvas"),u=d.getContext("2d"),c=this,h=[0,180];if(d.width=e.reader.width,d.height=e.reader.height,u.drawImage(c,0,0,e.reader.width,e.reader.height),"undefined"!=typeof e.editor.rotation){e.editor.rotation=e.editor.rotation||0,d.width=-1<h.indexOf(e.editor.rotation)?e.reader.width:e.reader.height,d.height=-1<h.indexOf(e.editor.rotation)?e.reader.height:e.reader.width;var m=e.editor.rotation*Math.PI/180,g=.5*d.width,v=.5*d.height;u.clearRect(0,0,d.width,d.height),u.translate(g,v),u.rotate(m),u.translate(.5*-e.reader.width,.5*-e.reader.height),u.drawImage(c,0,0),u.setTransform(1,0,0,1,0,0)}if(e.editor.crop){var b=u.getImageData(e.editor.crop.left,e.editor.crop.top,e.editor.crop.width,e.editor.crop.height);d.width=e.editor.crop.width,d.height=e.editor.crop.height,u.putImageData(b,0,0)}var w=i||e.type||"image/jpeg",x=n.editor.quality||90,_=d.toDataURL(w,x/100),y=function(i,d){var u=t?f._assets.dataURItoBlob(i,w):i;r?null:f.thumbnails.renderThumbnail(e,!0,d||i),a?a(u,e,l,p,o,s):null,null!=n.editor.onSave&&"function"==typeof n.editor.onSave?n.editor.onSave(u,e,l,p,o,s):null,f.set("listInput",null)};if(n.editor.maxWidth||n.editor.maxHeight){var k=new Image;k.src=_,k.onload=function(){var e=document.createElement("canvas");f.editor.resize(k,e,n.editor.maxWidth,n.editor.maxHeight,!0,!1),_=e.toDataURL(w,x/100),y(_,k),d=u=e=null}}else y(_),d=u=null}};if(d){if(!e.popup.editor.hasChanges)return;var h=e.popup.editor.scale||1;e.editor.rotation=e.popup.editor.rotation||0,e.popup.editor.cropper&&(e.editor.crop=e.popup.editor.cropper.crop,e.editor.crop.width=e.editor.crop.width/e.popup.editor.cropper.crop.cfWidth/h,e.editor.crop.left=e.editor.crop.left/e.popup.editor.cropper.crop.cfWidth/h,e.editor.crop.height=e.editor.crop.height/e.popup.editor.cropper.crop.cfHeight/h,e.editor.crop.top=e.editor.crop.top/e.popup.editor.cropper.crop.cfHeight/h)}f._assets.isMobile()?(u.onload=c,u.src=e.reader.src):e.reader.node?c.call(e.reader.node):e.reader.read(function(){c.call(e.reader.node)})}},sorter:{init:function(){p.on("mousedown touchstart",n.thumbnails._selectors.sorter,f.sorter.mousedown)},destroy:function(){p.off("mousedown touchstart",n.thumbnails._selectors.sorter,f.sorter.mousedown)},findItemAtPos:function(e){var t=f.sorter.sort,o=t.items.not(t.item.html),a=null;return o.each(function(t,o){var i=$(o);if(e.x>i.offset().left&&e.x<i.offset().left+i.outerWidth()&&e.y>i.offset().top&&e.y<i.offset().top+i.outerHeight())return a=i,!1}),a},mousedown:function(t){var e=t.originalEvent.touches&&t.originalEvent.touches[0]?"touchstart":"mousedown",o=$(t.target),i=o.closest(n.thumbnails._selectors.item),a=f.files.find(i),r={x:"mousedown"!=e&&i.length?t.originalEvent.touches[0].pageX:t.pageX,y:"mousedown"!=e&&i.length?t.originalEvent.touches[0].pageY:t.pageY},d=function(){f.sorter.sort={el:o,item:a,items:l.find(n.thumbnails._selectors.item),x:r.x,y:r.y,xItem:r.x-i.offset().left,yItem:r.y-i.offset().top,left:i.position().left,top:i.position().top,width:i.outerWidth(),height:i.outerHeight(),placeholder:n.sorter.placeholder?$(n.sorter.placeholder):a.html.clone().addClass("fileuploader-sorter-placeholder").html("")},$("body").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),$(document).on("mousemove touchmove",f.sorter.mousemove)};t.preventDefault(),f.sorter.sort&&f.sorter.mouseup(),!a||n.sorter.selectorExclude&&(o.is(n.sorter.selectorExclude)||o.closest(n.sorter.selectorExclude).length)||($(n.thumbnails._selectors.sorter).on("click drop dragend dragleave dragover dragenter dragstart touchstart touchmove touchend touchcancel",function(t){t.preventDefault()}),"mousedown"==e&&d(),"touchstart"==e&&(f.sorter.isTouchLongPress=!0,setTimeout(function(){f.sorter.isTouchLongPress&&(delete f.sorter.isTouchLongPress,d())},n.thumbnails.touchDelay?n.thumbnails.touchDelay:0)),$(document).on("mouseup touchend",f.sorter.mouseup))},mousemove:function(t){var e=t.originalEvent.touches&&t.originalEvent.touches[0]?"touchstart":"mousedown",o=f.sorter.sort,i=o.item,a=l.find(n.thumbnails._selectors.item),r=$(n.sorter.scrollContainer||window),d={left:$(document).scrollLeft(),top:$(document).scrollTop(),containerLeft:r.scrollLeft(),containerTop:r.scrollTop()},p={x:"mousedown"==e?t.clientX:t.originalEvent.touches[0].clientX,y:"mousedown"==e?t.clientY:t.originalEvent.touches[0].clientY};t.preventDefault();var s=p.x-o.xItem,u=p.y-o.yItem,c=p.x-(r.prop("offsetLeft")||0),h=p.y-(r.prop("offsetTop")||0);s+o.xItem>r.width()&&(s=r.width()-o.xItem),0>s+o.xItem&&(s=0-o.xItem),u+o.yItem>r.height()&&(u=r.height()-o.yItem),0>u+o.yItem&&(u=0-o.yItem),0>=h&&r.scrollTop(d.containerTop-10),h>r.height()&&r.scrollTop(d.containerTop+10),0>c&&r.scrollLeft(d.containerLeft-10),c>r.width()&&r.scrollLeft(d.containerLeft+10),i.html.addClass("sorting").css({position:"fixed",left:s,top:u,width:f.sorter.sort.width,height:f.sorter.sort.height}),l.find(o.placeholder).length||i.html.after(o.placeholder),o.placeholder.css({width:f.sorter.sort.width,height:f.sorter.sort.height});var m=f.sorter.findItemAtPos({x:s+o.xItem+d.left,y:u+o.yItem+d.top});if(m){var g=o.placeholder.offset().left!=m.offset().left,v=o.placeholder.offset().top!=m.offset().top;if(f.sorter.sort.lastHover&&f.sorter.sort.lastHover.el==m[0]){if(v&&"before"==f.sorter.sort.lastHover.direction&&p.y<f.sorter.sort.lastHover.y)return;if(v&&"after"==f.sorter.sort.lastHover.direction&&p.y>f.sorter.sort.lastHover.y)return;if(g&&"before"==f.sorter.sort.lastHover.direction&&p.x<f.sorter.sort.lastHover.x)return;if(g&&"after"==f.sorter.sort.lastHover.direction&&p.x>f.sorter.sort.lastHover.x)return}var b=a.index(i.html),w=a.index(m),x=b>w?"before":"after";m[x](o.placeholder),m[x](i.html),f.sorter.sort.lastHover={el:m[0],x:p.x,y:p.y,direction:x}}},mouseup:function(){var e=f.sorter.sort,t=e.item;$("body").css({"-webkit-user-select":"","-moz-user-select":"","-ms-user-select":"","user-select":""}),t.html.removeClass("sorting").css({position:"",left:"",top:"",width:"",height:""}),$(document).off("mousemove touchmove",f.sorter.mousemove),$(document).off("mouseup touchend",f.sorter.mouseup),e.placeholder.remove(),delete f.sorter.sort,f.sorter.save()},save:function(e){var t,i=0,a=[],r=[],d=e?f._itFl:n.thumbnails.itemPrepend?l.children().get().reverse():l.children();$.each(d,function(e,o){var d=o.file?o:f.files.find($(o));if(d){if(d.upload&&!d.uploaded)return;f.rendered&&d.index!=i&&(f._itSl&&f._itSl.indexOf(d.id)!=i||!0)&&(t=!0),d.index=i,a.push(d),r.push(d.id),i++}}),f._itSl&&f._itSl.length!=r.length&&(t=!0),f._itSl=r,t&&a.length==f._itFl.length&&(f._itFl=a),e||f.set("listInput","ignoreSorter"),t&&null!=n.sorter.onSort&&"function"==typeof n.sorter.onSort?n.sorter.onSort(a,l,p,o,s):null}},upload:{prepare:function(e,t){e.upload={url:n.upload.url,data:$.extend({},n.upload.data),formData:new FormData,type:n.upload.type||"POST",enctype:n.upload.enctype||"multipart/form-data",cache:!1,contentType:!1,processData:!1,chunk:e.upload?e.upload.chunk:null,status:null,send:function(){f.upload.send(e,!0)},cancel:function(t){f.upload.cancel(e,t)}},e.upload.formData.append(s.attr("name"),e.file,!!e.name&&e.name),(n.upload.start||t)&&f.upload.send(e,t)},send:function(t,i){if(t.upload){var a=function(e){t.html&&t.html.removeClass("upload-pending upload-loading upload-cancelled upload-failed upload-success").addClass("upload-"+(e||t.upload.status))},r=function(){var e=0;if(0<f._pfuL.length)for(-1<f._pfuL.indexOf(t)?f._pfuL.splice(f._pfuL.indexOf(t),1):null;e<f._pfuL.length;){if(-1<f._itFl.indexOf(f._pfuL[e])&&f._pfuL[e].upload&&!f._pfuL[e].upload.$ajax){f.upload.send(f._pfuL[e],!0);break}else f._pfuL.splice(e,1);e++}};if(n.upload.synchron&&!t.upload.chunk)if(t.upload.status="pending",t.html&&a(),i)-1<f._pfuL.indexOf(t)?f._pfuL.splice(f._pfuL.indexOf(t),1):null;else if(-1==f._pfuL.indexOf(t)?f._pfuL.push(t):null,1<f._pfuL.length)return;if(n.upload.chunk&&t.file.slice){var d=1e6*n.upload.chunk,u=Math.ceil(t.size/d,d);if(1<u&&!t.upload.chunk&&(t.upload.chunk={name:t.name,size:t.file.size,type:t.file.type,chunkSize:d,temp_name:t.name,loaded:0,total:u,i:-1}),t.upload.chunk)if(t.upload.chunk.i++,delete t.upload.chunk.isFirst,delete t.upload.chunk.isLast,0==t.upload.chunk.i&&(t.upload.chunk.isFirst=!0),t.upload.chunk.i==t.upload.chunk.total-1&&(t.upload.chunk.isLast=!0),t.upload.chunk.i<=t.upload.chunk.total-1){var c=t.upload.chunk.i*t.upload.chunk.chunkSize,h=t.file.slice(c,c+t.upload.chunk.chunkSize);t.upload.formData=new FormData,t.upload.formData.append(s.attr("name"),h),t.upload.data._chunkedd=JSON.stringify(t.upload.chunk)}else delete t.upload.chunk}if(n.upload.beforeSend&&$.isFunction(n.upload.beforeSend)&&!1===n.upload.beforeSend(t,l,p,o,s))return delete t.upload.chunk,a(),void r();if(p.addClass("fileuploader-is-uploading"),t.upload.$ajax&&t.upload.$ajax.abort(),delete t.upload.$ajax,delete t.upload.send,t.upload.status="loading",t.html&&(n.thumbnails._selectors.start&&t.html.find(n.thumbnails._selectors.start).remove(),a()),t.upload.data)for(var m in t.upload.data)t.upload.data.hasOwnProperty(m)&&t.upload.formData.append(m,t.upload.data[m]);t.upload.data=t.upload.formData,t.upload.xhr=function(){var e=$.ajaxSettings.xhr(),o=t.upload.chunk&&t.upload.chunk.xhrStartedAt?t.upload.chunk.xhrStartedAt:new Date;return e.upload&&e.upload.addEventListener("progress",function(i){t.upload.$ajax&&(t.upload.$ajax.total=t.upload.chunk?t.upload.chunk.size:i.total,t.upload.$ajax.xhrStartedAt=o),f.upload.progressHandling(i,t,o)},!1),e},t.upload.complete=function(e,i){if(t.upload.chunk&&!t.upload.chunk.isLast&&"success"==i)return f.upload.send(t);r();var d=!0;$.each(f._itFl,function(e,t){t.upload&&t.upload.$ajax&&(d=!1)}),d&&(p.removeClass("fileuploader-is-uploading"),null!=n.upload.onComplete&&"function"==typeof n.upload.onComplete?n.upload.onComplete(l,p,o,s,e,i):null)},t.upload.success=function(e,i,r){if(t.upload.chunk&&!t.upload.chunk.isLast){try{var d=JSON.parse(e);t.upload.chunk.temp_name=d.fileuploader.temp_name}catch(t){}return}delete t.upload.chunk,f.upload.progressHandling(null,t,t.upload.$ajax.xhrStartedAt,!0),t.uploaded=!0,delete t.upload,t.upload={status:"successful",resend:function(){f.upload.retry(t)}},t.html&&a(),null!=n.upload.onSuccess&&$.isFunction(n.upload.onSuccess)?n.upload.onSuccess(e,t,l,p,o,s,i,r):null,f.set("listInput",null)},t.upload.error=function(e,i,r){t.upload.chunk&&(t.upload.chunk.i=Math.max(-1,t.upload.chunk.i-1)),t.uploaded=!1,t.upload.status="cancelled"==t.upload.status?t.upload.status:"failed",t.upload.retry=function(){f.upload.retry(t)},delete t.upload.$ajax,t.html&&a(),null!=n.upload.onError&&$.isFunction(n.upload.onError)?n.upload.onError(t,l,p,o,s,e,i,r):null},t.upload.$ajax=$.ajax(t.upload)}},cancel:function(e,t){e&&e.upload&&(e.upload.status="cancelled",delete e.upload.chunk,e.upload.$ajax?e.upload.$ajax.abort():null,delete e.upload.$ajax,t?null:f.files.remove(e))},retry:function(e){e&&e.upload&&(e.html&&n.thumbnails._selectors.retry&&e.html.find(n.thumbnails._selectors.retry).remove(),f.upload.prepare(e,!0))},progressHandling:function(t,i,a,r){if(!t&&r&&i.upload.$ajax&&(t={total:i.upload.$ajax.total,loaded:i.upload.$ajax.total,lengthComputable:!0}),t.lengthComputable){var d=t.loaded+(i.upload.chunk?i.upload.chunk.loaded:0),u=i.upload.chunk?i.upload.chunk.size:t.total,c=Math.round(100*d/u),h=i.upload.chunk&&i.upload.chunk.xhrStartedAt?i.upload.chunk.xhrStartedAt:a,m=(new Date().getTime()-h.getTime())/1e3,g=m?d/m:0,v=Math.max(0,u-d),b=Math.max(0,m?v/g:0),w={loaded:d,loadedInFormat:f._assets.bytesToText(d),total:u,totalInFormat:f._assets.bytesToText(u),percentage:c,secondsElapsed:m,secondsElapsedInFormat:f._assets.secondsToText(m,!0),bytesPerSecond:g,bytesPerSecondInFormat:f._assets.bytesToText(g)+"/s",remainingBytes:v,remainingBytesInFormat:f._assets.bytesToText(v),secondsRemaining:b,secondsRemainingInFormat:f._assets.secondsToText(b,!0)};i.upload.chunk&&(i.upload.chunk.isFirst&&(i.upload.chunk.xhrStartedAt=a),t.loaded==t.total&&!i.upload.chunk.isLast&&(i.upload.chunk.loaded+=Math.max(t.total,i.upload.chunk.total/i.upload.chunk.chunkSize))),99<w.percentage&&!r&&(w.percentage=99),n.upload.onProgress&&$.isFunction(n.upload.onProgress)?n.upload.onProgress(w,i,l,p,o,s):null}}},dragDrop:{onDragEnter:function(t){clearTimeout(f.dragDrop._timer),n.dragDrop.container.addClass("fileuploader-dragging"),f.set("feedback",f._assets.textParse(n.captions.drop)),null!=n.dragDrop.onDragEnter&&$.isFunction(n.dragDrop.onDragEnter)?n.dragDrop.onDragEnter(t,l,p,o,s):null},onDragLeave:function(t){clearTimeout(f.dragDrop._timer),f.dragDrop._timer=setTimeout(function(t){return!!f.dragDrop._dragLeaveCheck(t)&&void(n.dragDrop.container.removeClass("fileuploader-dragging"),f.set("feedback",null),null!=n.dragDrop.onDragLeave&&$.isFunction(n.dragDrop.onDragLeave)?n.dragDrop.onDragLeave(t,l,p,o,s):null)},100,t)},onDrop:function(t){clearTimeout(f.dragDrop._timer),n.dragDrop.container.removeClass("fileuploader-dragging"),f.set("feedback",null),t&&t.originalEvent&&t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.files&&t.originalEvent.dataTransfer.files.length&&(f.isUploadMode()?f.onChange(t,t.originalEvent.dataTransfer.files):s.prop("files",t.originalEvent.dataTransfer.files).trigger("change")),null!=n.dragDrop.onDrop&&$.isFunction(n.dragDrop.onDrop)?n.dragDrop.onDrop(t,l,p,o,s):null},_dragLeaveCheck:function(t){var e,o=$(t.currentTarget);return o.is(n.dragDrop.container)||(e=n.dragDrop.container.find(o),!e.length)}},clipboard:{paste:function(t){if(f._assets.isIntoView(o)&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items&&t.originalEvent.clipboardData.items.length){var e=t.originalEvent.clipboardData.items;f.clipboard.clean();for(var a=0;a<e.length;a++)if(-1!==e[a].type.indexOf("image")||-1!==e[a].type.indexOf("text/uri-list")){var r=e[a].getAsFile(),d=1<n.clipboardPaste?n.clipboardPaste:2e3;r&&(r._name=f._assets.generateFileName(-1==r.type.indexOf("/")?"png":r.type.split("/")[1].toString().toLowerCase(),"Clipboard "),f.set("feedback",f._assets.textParse(n.captions.paste,{ms:d/1e3})),f.clipboard._timer=setTimeout(function(){f.set("feedback",null),f.onChange(t,[r])},d-2))}}},clean:function(){f.clipboard._timer&&(clearTimeout(f.clipboard._timer),delete f.clipboard._timer,f.set("feedback",null))}},files:{add:function(e,t){var o,i,a=e._name||e.name,r=e.size,d=f._assets.bytesToText(r),p=e.type,l=p?p.split("/",1).toString().toLowerCase():"",u=-1==a.indexOf(".")?"":a.split(".").pop().toLowerCase(),c=a.substr(0,a.length-(-1==a.indexOf(".")?u.length:u.length+1)),h=e.data||{},m=e.file||e,g="updated"==t?e.id:Date.now(),h={name:a,title:c,size:r,size2:d,type:p,format:l,extension:u,data:h,file:m,reader:{read:function(e,t,o){return f.files.read(i,e,t,o)}},id:g,input:"choosed"==t?s:null,html:null,choosed:"choosed"==t,appended:"appended"==t||"updated"==t,uploaded:"uploaded"==t};return"updated"==t?(o=f._itFl.indexOf(e),f._itFl[o]=i=h):(f._itFl.push(h),o=f._itFl.length-1,i=f._itFl[o]),i.remove=function(){f.files.remove(i)},n.editor&&"image"==l&&(i.editor={rotate:function(e){f.editor.rotate(i,e)},cropper:function(e){f.editor.crop(i,e)},save:function(e,t,o,a){f.editor.save(i,t,o,e,a)}}),e.local&&(i.local=e.local),o},read:function(t,i,a,r,d){if(f.isFileReaderSupported()&&!t.data.readerSkip){var u=new FileReader,c=window.URL||window.webkitURL,h=d&&t.data.thumbnail,m="string"!=typeof t.file,g=function(){var e=t.reader._callbacks||[];t.reader._timer&&(clearTimeout(t.reader._timer),delete t.reader._timer),delete t.reader._callbacks,delete t.reader._FileReader;for(var a=0;a<e.length;a++)$.isFunction(e[a])?e[a](t,l,p,o,s):null;n.onFileRead&&$.isFunction(n.onFileRead)?n.onFileRead(t,l,p,o,s):null};if((t.reader.src||t.reader._FileReader)&&!r||(t.reader={_FileReader:u,_callbacks:[],read:t.reader.read}),t.reader.src&&!r)return i&&$.isFunction(i)?i(t,l,p,o,s):null;if(i&&t.reader._callbacks&&(t.reader._callbacks.push(i),1<t.reader._callbacks.length))return;if("astext"==t.format)u.onload=function(o){var e=document.createElement("div");t.reader.node=e,t.reader.src=o.target.result,t.reader.length=o.target.result.length,e.innerHTML=t.reader.src.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),g()},u.onerror=function(){g(),t.reader={read:t.reader.read}},m?u.readAsText(t.file):$.ajax({url:t.file,success:function(e){u.onload({target:{result:e}})},error:function(){u.onerror()}});else if("image"==t.format||h){var v;if(u.onload=function(o){var e=new Image,i=function(){t.data&&t.data.readerCrossOrigin&&e.setAttribute("crossOrigin",t.data.readerCrossOrigin),e.src=o.target.result+((t.data.readerForce||r)&&!m&&!h&&-1==o.target.result.indexOf("data:image")?(-1==o.target.result.indexOf("?")?"?":"&")+"d="+Date.now():""),e.onload=function(){if(t.reader.exifOrientation){var o=document.createElement("canvas"),i=o.getContext("2d"),a=e,r=t.reader.exifOrientation,d=[0,180];o.width=a.naturalWidth,o.height=a.naturalHeight,i.drawImage(a,0,0),o.width=-1<d.indexOf(r)?a.naturalWidth:a.naturalHeight,o.height=-1<d.indexOf(r)?a.naturalHeight:a.naturalWidth;var n=r*Math.PI/180,p=.5*o.width,s=.5*o.height;return i.clearRect(0,0,o.width,o.height),i.translate(p,s),i.rotate(n),i.translate(.5*-a.naturalWidth,.5*-a.naturalHeight),i.drawImage(a,0,0),i.setTransform(1,0,0,1,0,0),e.src=o.toDataURL(t.type,1),void delete t.reader.exifOrientation}t.reader.node=e,t.reader.src=e.src,t.reader.width=e.width,t.reader.height=e.height,t.reader.ratio=f._assets.pxToRatio(t.reader.width,t.reader.height),v&&c.revokeObjectURL(v),g(),h&&(t.reader={read:t.reader.read})},e.onerror=function(){g(),t.reader={read:t.reader.read}}};n.thumbnails.exif&&t.choosed?f._assets.getExifOrientation(t.file,function(e){e&&(t.reader.exifOrientation=e),i()}):i()},u.onerror=function(){g(),t.reader={read:t.reader.read}},!h&&Math.round(t.size/1e6)>n.reader.maxSize)return u.onerror();m?n.thumbnails.useObjectUrl&&n.thumbnails.canvasImage&&c?u.onload({target:{result:v=c.createObjectURL(t.file)}}):u.readAsDataURL(t.file):u.onload({target:{result:h?t.data.thumbnail:t.file}})}else if("video"==t.format||"audio"==t.format){var v,b=document.createElement(t.format),w=b.canPlayType(t.type);if(u.onerror=function(){t.reader.node=null,g(),t.reader={read:t.reader.read}},c&&""!==w){if(d&&!n.thumbnails.videoThumbnail)return t.reader.node=b,g(),void(t.reader={read:t.reader.read});v=m?c.createObjectURL(t.file):t.file,b.onloadedmetadata=function(){t.reader.node=b,t.reader.src=b.src,t.reader.duration=b.duration,t.reader.duration2=f._assets.secondsToText(b.duration),"video"==t.format&&(t.reader.width=b.videoWidth,t.reader.height=b.videoHeight,t.reader.ratio=f._assets.pxToRatio(t.reader.width,t.reader.height))},b.onerror=function(){g(),t.reader={read:t.reader.read}},b.onloadeddata=function(){if("video"==t.format){var e=document.createElement("canvas"),o=e.getContext("2d");e.width=b.videoWidth,e.height=b.videoHeight,o.drawImage(b,0,0,e.width,e.height),t.reader.frame=f._assets.isBlankCanvas(e)?null:e.toDataURL(),e=o=null}g()},setTimeout(function(){t.data&&t.data.readerCrossOrigin&&b.setAttribute("crossOrigin",t.data.readerCrossOrigin),b.src=v+"#t=1"},100)}else u.onerror()}else if("application/pdf"==t.type&&n.thumbnails.pdf){var b=document.createElement("iframe"),v=m?c.createObjectURL(t.file):(n.thumbnails.pdf.urlPrefix||"")+t.file;n.thumbnails.pdf.viewer||f._assets.hasPlugin("pdf")?(b.onload=function(){t.reader.node=b,t.reader.src=b.src,b.style.display="",g()},b.src=(n.thumbnails.pdf.viewer||"")+v,b.style.display="none",document.body.appendChild(b)):g()}else u.onload=function(o){t.reader.src=o.target.result,t.reader.length=o.target.result.length,g()},u.onerror=function(){g(),t.reader={read:t.reader.read}},m?u[a||"readAsBinaryString"](t.file):g();t.reader._timer=setTimeout(u.onerror,d?n.reader.thumbnailTimeout:n.reader.timeout)}else i&&i(t,l,p,o,s);return null},list:function(e,t,i,a){var r=[];return!n.sorter||i||a&&"ignoreSorter"==a||f.sorter.save(!0),$.each(f._itFl,function(o,i){var a=i;if(a.upload&&!a.uploaded)return!0;if((t||e)&&(a=(a.choosed&&!a.uploaded?"0:/":"")+(t&&null!==f.files.getItemAttr(i,t)?f.files.getItemAttr(a,t):a.local||a["string"==typeof a.file?"file":"name"])),e&&(a={file:a},i.editor&&(i.editor.crop||i.editor.rotation)&&(a.editor={},i.editor.rotation&&(a.editor.rotation=i.editor.rotation),i.editor.crop&&(a.editor.crop=i.editor.crop)),"undefined"!=typeof i.index&&(a.index=i.index),i.data&&i.data.listProps))for(var d in i.data.listProps)a[d]=i.data.listProps[d];r.push(a)}),r=n.onListInput&&$.isFunction(n.onListInput)?n.onListInput(r,f._itFl,n.listInput,l,p,o,s):r,e?JSON.stringify(r):r},check:function(e,t,i){var d=["warning",null,!1,!1];if(null!=n.limit&&i&&t.length+f._itFl.length-1>n.limit)return d[1]=f._assets.textParse(n.captions.errors.filesLimit),d[3]=!0,d;if(null!=n.maxSize&&i){var r=0;if($.each(f._itFl,function(e,t){r+=t.size}),r-=e.size,$.each(t,function(e,t){r+=t.size}),r>Math.round(1e6*n.maxSize))return d[1]=f._assets.textParse(n.captions.errors.filesSizeAll),d[3]=!0,d}if(null!=n.onFilesCheck&&$.isFunction(n.onFilesCheck)&&i){var a=n.onFilesCheck(t,n,l,p,o,s);if(!1===a)return d[3]=!0,d}if(null!=n.extensions&&-1==$.inArray(e.extension,n.extensions)&&!n.extensions.filter(function(t){return e.type.length&&(-1<t.indexOf(e.type)||-1<t.indexOf(e.format+"/*"))}).length)return d[1]=f._assets.textParse(n.captions.errors.filesType,e),d;if(null!=n.disallowedExtensions&&(-1<$.inArray(e.extension,n.disallowedExtensions)||n.disallowedExtensions.filter(function(t){return!e.type.length||-1<t.indexOf(e.type)||-1<t.indexOf(e.format+"/*")}).length))return d[1]=f._assets.textParse(n.captions.errors.filesType,e),d;if(null!=n.fileMaxSize&&e.size>1e6*n.fileMaxSize)return d[1]=f._assets.textParse(n.captions.errors.fileSize,e),d;if(0==e.size&&""==e.type)return d[1]=f._assets.textParse(n.captions.errors.remoteFile,e),d;if(4096==e.size&&""==e.type)return d[1]=f._assets.textParse(n.captions.errors.folderUpload,e),d;if(!n.skipFileNameCheck){var r=!1;if($.each(f._itFl,function(o,i){if(i!=e&&!0==i.choosed&&i.file&&i.name==e.name)return r=!0,i.file.size==e.size&&i.file.type==e.type&&(!(e.file.lastModified&&i.file.lastModified)||i.file.lastModified==e.file.lastModified)&&1<t.length?d[2]=!0:(d[1]=f._assets.textParse(n.captions.errors.fileName,e),d[2]=!1),!1}),r)return d}return!0},append:function(e){if(e=$.isArray(e)?e:[e],e.length){for(var t,a=0;a<e.length;a++)f._assets.keyCompare(e[a],["name","file","size","type"])&&(t=f._itFl[f.files.add(e[a],"appended")],n.thumbnails?f.thumbnails.item(t):null);return f.set("feedback",null),f.set("listInput",null),n.afterSelect&&$.isFunction(n.afterSelect)?n.afterSelect(l,p,o,s):null,1!=e.length||t}},update:function(e,t){if(!(-1==f._itFl.indexOf(e)||e.upload&&e.upload.$ajax)){var o=e,i=f.files.add($.extend(e,t),"updated"),e=f._itFl[i];e.popup&&e.popup.close&&e.popup.close(),n.thumbnails&&o.html&&f.thumbnails.item(e,o.html),f.set("listInput",null)}},find:function(e){var t=null;return $.each(f._itFl,function(o,i){if(i.html&&i.html.is(e))return t=i,!1}),t},remove:function(e,t){if(!(!t&&n.onRemove&&$.isFunction(n.onRemove)&&!1===n.onRemove(e,l,p,o,s))){if(e.html&&(n.thumbnails.onItemRemove&&$.isFunction(n.thumbnails.onItemRemove)&&!t?n.thumbnails.onItemRemove(e.html,l,p,o,s):e.html.remove()),e.upload&&e.upload.$ajax&&e.upload.cancel&&e.upload.cancel(!0),e.popup&&e.popup.close&&e.popup.close(),e.reader.src&&(e.reader.node=null,URL.revokeObjectURL(e.reader.src)),e.input){var r=!0;$.each(f._itFl,function(o,i){if(e!=i&&(e.input==i.input||t&&1<e.input.get(0).files.length))return r=!1,!1}),r&&(f.isAddMoreMode()&&1<sl.length?(f.set("nextInput"),sl.splice(sl.indexOf(e.input),1),e.input.remove()):f.set("input",""))}-1<f._pfrL.indexOf(e)?f._pfrL.splice(f._pfrL.indexOf(e),1):null,-1<f._pfuL.indexOf(e)?f._pfuL.splice(f._pfuL.indexOf(e),1):null,-1<f._itFl.indexOf(e)?f._itFl.splice(f._itFl.indexOf(e),1):null,e=null,0==f._itFl.length?f.reset():null,f.set("feedback",null),f.set("listInput",null)}},getItemAttr:function(e,t){var o=null;return e&&("undefined"==typeof e[t]?e.data&&"undefined"!=typeof e.data[t]&&(o=e.data[t]):o=e[t]),o},clear:function(e){for(var t,r=0;r<f._itFl.length;){if(t=f._itFl[r],!e&&t.appended){r++;continue}t.html&&(t.html?f._itFl[r].html.remove():null),t.upload&&t.upload.$ajax&&f.upload.cancel(t),f._itFl.splice(r,1)}f.set("feedback",null),f.set("listInput",null),0==f._itFl.length&&n.onEmpty&&$.isFunction(n.onEmpty)?n.onEmpty(l,p,o,s):null}},reset:function(e){e&&(f.clipboard._timer&&f.clipboard.clean(),$.each(sl,function(e,t){e<sl.length&&t.remove()}),sl=[],f.set("input","")),f._itRl=[],f._pfuL=[],f._pfrL=[],f.files.clear(e)},destroy:function(){f.reset(!0),f.bindUnbindEvents(!1),s.removeAttr("style"),p.before(s),delete s.get(0).FileUploader,p.remove(),p=o=l=null},_assets:{bytesToText:function(e){if(0==e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},escape:function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},secondsToText:function(e,t){e=parseInt(Math.round(e),10);var o=Math.floor(e/3600),i=Math.floor((e-3600*o)/60),e=e-3600*o-60*i,a="";return(0<o||!t)&&(a+=(10>o?"0":"")+o+(t?"h ":":")),(0<i||!t)&&(a+=(10>i&&!t?"0":"")+i+(t?"m ":":")),a+=(10>e&&!t?"0":"")+e+(t?"s":""),a},pxToRatio:function(e,t){var o=function(e,t){return 0==t?e:o(t,e%t)},i=o(e,t);return[e/i,t/i]},ratioToPx:function(e,t,o){if(o=(o+"").split(":"),2>o.length)return null;var i=t/o[1]*o[0],a=e/o[0]*o[1];return[i,a,o[0],o[1]]},hasAttr:function(e,t){var t=t?t:s,o=t.attr(e);return!!(o&&"undefined"!=typeof o)},copyAllAttributes:function(e,t){return $.each(t.get(0).attributes,function(){"required"==this.name||"type"==this.name||e.attr(this.name,this.value)}),t.get(0).FileUploader&&(e.get(0).FileUploader=t.get(0).FileUploader),e},getAllEvents:function(e){var e=e?e:s,t=[];for(var o in e=e.get?e.get(0):e,e)0===o.indexOf("on")&&t.push(o.slice(2));return-1==t.indexOf("change")&&t.push("change"),t.join(" ")},isIntoView:function(e){var t=$(window).scrollTop(),o=t+window.innerHeight,i=e.offset().top,a=i+e.outerHeight();return t<i&&o>a},isBlankCanvas:function(e){var t=document.createElement("canvas"),o=!1;t.width=e.width,t.height=e.height;try{o=e.toDataURL()==t.toDataURL()}catch(t){}return t=null,o},generateFileName:function(e,t){var o=new Date,i=function(e){return 10>e&&(e="0"+e),e},t=t?t:"",e=e?"."+e:"";return t+o.getFullYear()+"-"+i(o.getMonth()+1)+"-"+i(o.getDate())+" "+i(o.getHours())+"-"+i(o.getMinutes())+"-"+i(o.getSeconds())+e},arrayBufferToBase64:function(e){for(var t="",o=new Uint8Array(e),a=0;a<o.byteLength;a++)t+=String.fromCharCode(o[a]);return window.btoa(t)},dataURItoBlob:function(e,t){for(var o=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(o.length),d=new Uint8Array(r),n=0;n<o.length;n++)d[n]=o.charCodeAt(n);var p=new DataView(r),s=new Blob([p.buffer],{type:t||a});return s},getExifOrientation:function(e,t){var o=new FileReader,a={1:0,3:180,6:90,8:270};o.onload=function(o){var e=new DataView(o.target.result),r=1;if(e.byteLength&&65496==e.getUint16(0,!1))for(var d,n=e.byteLength,p=2;p<n&&!(8>=e.getUint16(p+2,!1));)if(d=e.getUint16(p,!1),p+=2,65505==d){if(1165519206!=e.getUint32(p+=2,!1))break;var s,l=18761==e.getUint16(p+=6,!1);p+=e.getUint32(p+4,l),s=e.getUint16(p,l),p+=2;for(var u=0;u<s;u++)if(274==e.getUint16(p+12*u,l)){r=e.getUint16(p+12*u+8,l),n=0;break}}else if(65280!=(65280&d))break;else p+=e.getUint16(p,!1);t?t(a[r]||0):null},o.onerror=function(){t?t(""):null},o.readAsArrayBuffer(e)},textParse:function(text,opts,noOptions){switch(opts=noOptions?opts||{}:$.extend({},{limit:n.limit,maxSize:n.maxSize,fileMaxSize:n.fileMaxSize,extensions:n.extensions?n.extensions.join(", "):null,captions:n.captions},opts),typeof text){case"string":for(var key in opts)-1<["name","file","type","size"].indexOf(key)&&(opts[key]=f._assets.escape(opts[key]));text=text.replace(/\$\{(.*?)\}/g,function(match,a){var a=a.replace(/ /g,""),r="undefined"!=typeof opts[a]&&null!=opts[a]?opts[a]:"";if(-1<["reader.node"].indexOf(a))return match;if(-1<a.indexOf(".")||-1<a.indexOf("[]")){var x=a.substr(0,-1<a.indexOf(".")?a.indexOf("."):-1<a.indexOf("[")?a.indexOf("["):a.length),y=a.substring(x.length);if(opts[x])try{r=eval("opts[\""+x+"\"]"+y)}catch(t){r=""}}return r=$.isFunction(r)?f._assets.textParse(r):r,r||""});break;case"function":text=f._assets.textParse(text(opts,l,p,o,s,f._assets.textParse),opts,noOptions);}return opts=null,text},textToColor:function(e){if(!e||0==e.length)return!1;for(var t=0,o=0;t<e.length;o=e.charCodeAt(t++)+((o<<5)-o));for(var t=0,a="#";3>t;a+=("00"+(255&o>>2*t++).toString(16)).slice(-2));return a},isBrightColor:function(e){var t=function(e){var t;return e&&e.constructor==Array&&3==e.length?e:(t=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))?[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]:(t=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))?[2.55*parseFloat(t[1]),2.55*parseFloat(t[2]),2.55*parseFloat(t[3])]:(t=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:(t=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]:"undefined"==typeof colors?null:colors[$.trim(e).toLowerCase()]};return 194<function(e){var o=t(e);return o?.2126*o[0]+.7152*o[1]+.0722*o[2]:null}(e)},keyCompare:function(e,t){for(var o=0;o<t.length;o++)if(!$.isPlainObject(e)||!e.hasOwnProperty(t[o]))throw new Error("Could not find valid *strict* attribute \""+t[o]+"\" in "+JSON.stringify(e,null,4));return!0},hasPlugin:function(e){if(navigator.plugins&&navigator.plugins.length)for(var t in navigator.plugins)if(-1<navigator.plugins[t].name.toLowerCase().indexOf(e))return!0;return!1},isIE:function(){return-1<navigator.userAgent.indexOf("MSIE ")||-1<navigator.userAgent.indexOf("Trident/")||-1<navigator.userAgent.indexOf("Edge")},isMobile:function(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}},isSupported:function(){return s&&s.get(0).files},isFileReaderSupported:function(){return window.File&&window.FileList&&window.FileReader},isDefaultMode:function(){return!n.upload&&(!n.addMore||1==n.limit)},isAddMoreMode:function(){return!n.upload&&n.addMore&&1!=n.limit},isUploadMode:function(){return n.upload},_itFl:[],_pfuL:[],_pfrL:[],disabled:!1,locked:!1,rendered:!1};return n.enableApi&&(s.get(0).FileUploader={open:function(){s.trigger("click")},getOptions:function(){return n},getParentEl:function(){return p},getInputEl:function(){return s},getNewInputEl:function(){return o},getListEl:function(){return l},getListInputEl:function(){return n.listInput},getFiles:function(){return f._itFl},getChoosedFiles:function(){return f._itFl.filter(function(e){return e.choosed})},getAppendedFiles:function(){return f._itFl.filter(function(e){return e.appended})},getUploadedFiles:function(){return f._itFl.filter(function(e){return e.uploaded})},getFileList:function(e,t){return f.files.list(e,t,!0)},updateFileList:function(){return f.set("listInput",null),!0},setOption:function(e,t){return n[e]=t,!0},findFile:function(e){return f.files.find(e)},add:function(e,t,o){if(!f.isUploadMode())return!1;var i;if(e instanceof Blob)i=e;else{var a=/data:[a-z]+\/[a-z]+\;base64\,/.test(e)?e:"data:"+t+";base64,"+btoa(e);i=f._assets.dataURItoBlob(a,t)}return i._name=o||f._assets.generateFileName(-1==i.type.indexOf("/")?"File ":i.type.split("/")[1].toString().toLowerCase()),f.onChange(null,[i]),!0},append:function(e){return f.files.append(e)},update:function(e,t){return f.files.update(e,t)},remove:function(e){return e=e.jquery?f.files.find(e):e,!!(-1<f._itFl.indexOf(e))&&(f.files.remove(e),!0)},uploadStart:function(){var e=this.getChoosedFiles()||[];if(f.isUploadMode()&&0<e.length&&!e[0].uploaded)for(var t=0;t<e.length;t++)f.upload.send(e[t])},reset:function(){return f.reset(!0),!0},disable:function(e){return f.set("disabled",!0),e&&(f.locked=!0),!0},enable:function(){return f.set("disabled",!1),f.locked=!1,!0},destroy:function(){return f.destroy(),!0},isEmpty:function(){return 0==f._itFl.length},isDisabled:function(){return f.disabled},isRendered:function(){return f.rendered},assets:f._assets,getPluginMode:function(){return f.isDefaultMode()?"default":f.isAddMoreMode()?"addMore":f.isUploadMode()?"upload":void 0}}),f.init(),this})},$.fileuploader={getInstance:function(e){var t=e.prop?e:$(e);return t.get(0).FileUploader}},$.fn.fileuploader.defaults={limit:null,maxSize:null,fileMaxSize:null,extensions:null,disallowedExtensions:null,changeInput:!0,inputNameBrackets:!0,theme:"default",thumbnails:{box:"<div class=\"fileuploader-items\"><ul class=\"fileuploader-items-list\"></ul></div>",boxAppendTo:null,item:"<li class=\"fileuploader-item file-has-popup\"><div class=\"columns\"><div class=\"column-thumbnail\">${image}<span class=\"fileuploader-action-popup\"></span></div><div class=\"column-title\"><div title=\"${name}\">${name}</div><span>${size2}</span></div><div class=\"column-actions\"><a class=\"fileuploader-action fileuploader-action-remove\" title=\"${captions.remove}\"><i></i></a></div></div><div class=\"progress-bar2\">${progressBar}<span></span></div></li>",item2:"<li class=\"fileuploader-item file-has-popup\"><div class=\"columns\"><div class=\"column-thumbnail\">${image}<span class=\"fileuploader-action-popup\"></span></div><div class=\"column-title\"><a href=\"${file}\" target=\"_blank\"><div title=\"${name}\">${name}</div><span>${size2}</span></a></div><div class=\"column-actions\"><a href=\"${file}\" class=\"fileuploader-action fileuploader-action-download\" title=\"${captions.download}\" download><i></i></a><a class=\"fileuploader-action fileuploader-action-remove\" title=\"${captions.remove}\"><i></i></a></div></div></li>",popup:{container:"body",loop:!0,arrows:!0,zoomer:!0,template:function(e){return"<div class=\"fileuploader-popup-preview\"><a class=\"fileuploader-popup-move\" data-action=\"prev\"></a><div class=\"fileuploader-popup-node ${format}\">${reader.node}</div><div class=\"fileuploader-popup-content\"><div class=\"fileuploader-popup-footer\"><ul class=\"fileuploader-popup-tools\">"+("image"==e.format&&e.editor?(e.editor.cropper?"<li><a data-action=\"crop\"><i></i> ${captions.crop}</a></li>":"")+(e.editor.rotate?"<li><a data-action=\"rotate-cw\"><i></i> ${captions.rotate}</a></li>":""):"")+("image"==e.format?"<li class=\"fileuploader-popup-zoomer\"><a data-action=\"zoom-out\">&minus;</a><input type=\"range\" min=\"0\" max=\"100\"><a data-action=\"zoom-in\">&plus;</a><span></span> </li>":"")+"<li><a data-action=\"remove\"><i></i> ${captions.remove}</a></li></ul></div><div class=\"fileuploader-popup-header\"><ul class=\"fileuploader-popup-meta\"><li><span>${captions.name}:</span><h5>${name}</h5></li><li><span>${captions.type}:</span><h5>${extension.toUpperCase()}</h5></li><li><span>${captions.size}:</span><h5>${size2}</h5></li>"+(e.reader&&e.reader.width?"<li><span>${captions.dimensions}:</span><h5>${reader.width}x${reader.height}px</h5></li>":"")+(e.reader&&e.reader.duration?"<li><span>${captions.duration}:</span><h5>${reader.duration2}</h5></li>":"")+"</ul><div class=\"fileuploader-popup-info\"></div><ul class=\"fileuploader-popup-buttons\"><li><a class=\"fileuploader-popup-button\" data-action=\"cancel\">${captions.cancel}</a></li><li><a class=\"fileuploader-popup-button button-success\" data-action=\"save\">${captions.confirm}</a></li></ul></div></div><a class=\"fileuploader-popup-move\" data-action=\"next\"></a></div>"},onShow:function(e){e.popup.html.on("click","[data-action=\"remove\"]",function(){e.popup.close(),e.remove()}).on("click","[data-action=\"cancel\"]",function(){e.popup.close()}).on("click","[data-action=\"save\"]",function(){e.editor&&e.editor.save(),e.popup.close&&e.popup.close()})},onHide:null},itemPrepend:!1,removeConfirmation:!0,startImageRenderer:!0,synchronImages:!0,useObjectUrl:!1,canvasImage:!0,videoThumbnail:!0,pdf:!0,exif:!0,touchDelay:0,_selectors:{list:".fileuploader-items-list",item:".fileuploader-item",start:".fileuploader-action-start",retry:".fileuploader-action-retry",remove:".fileuploader-action-remove",sorter:".fileuploader-action-sort",rotate:".fileuploader-action-rotate",popup:".fileuploader-popup-preview",popup_open:".fileuploader-action-popup"},beforeShow:null,onItemShow:null,onItemRemove:function(e){e.children().animate({opacity:0},200,function(){setTimeout(function(){e.slideUp(200,function(){e.remove()})},100)})},onImageLoaded:null},editor:!1,sorter:!1,reader:{thumbnailTimeout:5e3,timeout:12e3,maxSize:20},files:null,upload:null,dragDrop:!0,addMore:!1,skipFileNameCheck:!1,clipboardPaste:!0,listInput:!0,enableApi:!1,listeners:null,onSupportError:null,beforeRender:null,afterRender:null,beforeSelect:null,onFilesCheck:null,onFileRead:null,onSelect:null,afterSelect:null,onListInput:null,onRemove:null,onEmpty:null,dialogs:{alert:function(e){return alert(e)},confirm:function(e,t){confirm(e)?t():null}},captions:{button:function(e){return"Browse "+(1==e.limit?"file":"files")},feedback:function(e){return"Choose "+(1==e.limit?"file":"files")+" to upload"},feedback2:function(e){return e.length+" "+(1<e.length?" files were":" file was")+" chosen"},confirm:"Confirm",cancel:"Cancel",name:"Name",type:"Type",size:"Size",dimensions:"Dimensions",duration:"Duration",crop:"Crop",rotate:"Rotate",sort:"Sort",download:"Download",remove:"Remove",drop:"Drop the files here to upload",paste:"<div class=\"fileuploader-pending-loader\"></div> Pasting a file, click here to cancel.",removeConfirmation:"Are you sure you want to remove this file?",errors:{filesLimit:"Only ${limit} files are allowed to be uploaded.",filesType:"Only ${extensions} files are allowed to be uploaded.",fileSize:"${name} is too large! Please choose a file up to ${fileMaxSize}MB.",filesSizeAll:"Files that you chose are too large! Please upload files up to ${maxSize} MB.",fileName:"File with the name ${name} is already selected.",remoteFile:"Remote files are not allowed.",folderUpload:"You are not allowed to upload folders."}}}})(jQuery);
